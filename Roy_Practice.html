<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 Scatter Plot with Lines</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- Add any additional styling if needed -->
</head>
<body>

<div id="chart"></div>
<div id="buttons"></div>

<script>
const dataUrls = {
    'January': 'https://raw.githubusercontent.com/roymadpis/Car_Collision_EDAV_Columbia_2023/main/data/data_for_d3/Jan_data.csv',
    'February': 'https://raw.githubusercontent.com/roymadpis/Car_Collision_EDAV_Columbia_2023/main/data/data_for_d3/Feb_data.csv'
};

let currentMonth = 'January';

// Load initial data
loadData(dataUrls[currentMonth]);

// Load data from CSV
function loadData(url) {
    d3.csv(url).then(data => {
        // Parse data types if needed
        data.forEach(d => {
            d.day_only = +d.day_only;
            d.total_crash = +d.total_crash;
        });

        // Create SVG container
        const width = 600;
        const height = 400;
        const svg = d3.select("#chart")
            .html("") // Clear previous content
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Create scales
        const xScale = d3.scaleLinear()
            .domain([1, 31]) // Assuming days go from 1 to 31
            .range([0, width]);

        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.total_crash)])
            .range([height, 0]);

        // Create axes
        const xAxis = d3.axisBottom(xScale);
        const yAxis = d3.axisLeft(yScale);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        svg.append("g")
            .call(yAxis);

        // Create color scale for months
        const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

        // Create scatter plot points
        const points = svg.selectAll("circle")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", d => xScale(d.day_only))
            .attr("cy", d => yScale(d.total_crash))
            .attr("r", 5) // Adjust the radius as needed
            .attr("fill", d => colorScale(d.Month))
            .attr("opacity", 0.7)
            .on("mouseover", showTooltip)
            .on("mouseout", hideTooltip);

        // Create lines for each month
        const line = d3.line()
            .x(d => xScale(d.day_only))
            .y(d => yScale(d.total_crash));

        const paths = svg.selectAll(".line")
            .data(d3.groups(data, d => d.Month))
            .enter()
            .append("path")
            .attr("class", d => `line ${d[0] === currentMonth ? 'visible' : 'hidden'}`)
            .attr("d", d => line(d[1]))
            .attr("stroke", d => colorScale(d[0]))
            .attr("stroke-width", 2)
            .attr("fill", "none")
            .attr("opacity", 0.5);

        // Legend
        const legend = svg.selectAll(".legend")
            .data(colorScale.domain())
            .enter()
            .append("g")
            .attr("class", "legend")
            .attr("transform", (d, i) => "translate(0," + i * 20 + ")");

        legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .attr("fill", colorScale);

        legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(d => d);

        // Tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        function showTooltip(event, d) {
            tooltip.transition()
                .duration(200)
                .style("opacity", .9);
            tooltip.html(`${d.Month}<br>Day: ${d.day_only}<br>Average Crashes: ${d.total_crash}`)
                .style("left", (event.pageX + 5) + "px")
                .style("top", (event.pageY - 28) + "px");
        }

        function hideTooltip() {
            tooltip.transition()
                .duration(500)
                .style("opacity", 0);
        }

        // Button functionality
        d3.select("#buttons")
            .selectAll("button")
            .data(Object.keys(dataUrls))
            .enter()
            .append("button")
            .text(d => d)
            .on("click", function (event, d) {
                // Toggle visibility of lines based on the selected month
                svg.selectAll(".line")
                    .attr("class", m => `line ${m[0] === d ? 'visible' : 'hidden'}`);
            });

    }).catch(error => {
        console.error("Error loading data:", error);
    });
}

</script>

</body>
</html>
